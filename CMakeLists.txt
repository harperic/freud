CMAKE_MINIMUM_REQUIRED(VERSION 2.6.2 FATAL_ERROR)

if (CMAKE_MAJOR_VERSION VERSION_GREATER 2)
if(COMMAND cmake_policy)
    cmake_policy(SET CMP0003 NEW)
    cmake_policy(SET CMP0026 OLD)
    cmake_policy(SET CMP0042 OLD)
endif(COMMAND cmake_policy)
endif()

project (FREUD)

add_subdirectory(CMake)
# setup version tagging info
include (CMake_version_options.cmake)

message(STATUS "Configuring FREUD ${FREUD_VERSION_LONG}")

# Handle user build options
include (CMake_build_options.cmake)
# macros
include (FREUDMacros)

# find TBB lib and includes
find_library(TBB_LIBRARY tbb
             PATHS ENV TBB_LINK)
find_path(TBB_INCLUDE_DIR tbb/tbb.h
          PATHS ENV TBB_INC)
include_directories(${TBB_INCLUDE_DIR})
if (TBB_LIBRARY)
    mark_as_advanced(TBB_LIBRARY)
endif()
if (TBB_INCLUDE_DIR)
    mark_as_advanced(TBB_INCLUDE_DIR)
endif()

# find ISPC
# find_program(ISPC_EXECUTABLE ispc)
# if (ISPC_EXECUTABLE)
#     mark_as_advanced(ISPC_EXECUTABLE)
# endif()

include(FREUDCFlagsSetup)

# setup python
include(FREUDPythonSetup)
include_directories(${PYTHON_INCLUDE_DIR})

# Find the boost libraries and set them up
include (FREUDBoostSetup)
include_directories(SYSTEM ${Boost_INCLUDE_DIR})

# Find CUDA and set it up
include (FREUDCUDASetup)
include_directories(SYSTEM ${CUDA_INCLUDE_DIRS})

# setup numpy
include (FREUDNumpySetup)
include_directories(${NUMPY_INCLUDE_DIR})
add_definitions(-DPY_ARRAY_UNIQUE_SYMBOL=PyArrayHandle)
add_definitions(-DNPY_NO_DEPRECATED_API=NPY_1_7_API_VERSION)

# set the default install prefix
IF(CMAKE_INSTALL_PREFIX_INITIALIZED_TO_DEFAULT)
    SET(CMAKE_INSTALL_PREFIX ${PYTHON_USER_SITE} CACHE PATH "Python site installation diretory (defaults to USER_SITE)" FORCE)
ENDIF(CMAKE_INSTALL_PREFIX_INITIALIZED_TO_DEFAULT)

add_subdirectory(cpp)
add_subdirectory(py)
add_subdirectory(doc)
